---
layout  : post
title   : luarocksë¡œ Hammerspoon íŒ¨í‚¤ì§€ ê´€ë¦¬í•˜ê¸°
summary : ìœ í•œë½ìŠ¤ê°€ ì•„ë‹ˆë¼ ë£¨ì•„ë½ìŠ¤ë¡œ ê¹¨ë—í•˜ê²Œ
date    : 2017-07-30 16:32:25 +0900
tags    : hammerspoon lua luarocks
toc     : true
comment : true
public  : true
---
* TOC
{:toc}

# Hammerspoon?

* [Hammerspoon](http://www.hammerspoon.org/)ì€ ë§¥ì—ì„œ ëŒì•„ê°€ëŠ” ë§¤í¬ë¡œ íˆ´ì´ë‹¤.
* Windowsì˜ [Autohotkey](https://autohotkey.com/)ì™€ ë¹„ìŠ·í•œ ëŠë‚Œìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
* ë§¥ APIë‚˜ Swift, Objective-C ê°™ì€ ê±¸ ëª°ë¼ë„ ê·¸ëŸ­ì €ëŸ­ ì“¸ë§Œí•œ ë„êµ¬ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.

ëŒ€ì¶© ë‹¤ìŒê³¼ ê°™ì€ ì¼ì„ í•  ìˆ˜ ìˆë‹¤ê³  ë³´ë©´ ëœë‹¤.

* `Esc` í‚¤ë¥¼ ëˆ„ë¥¼ ë•Œë§ˆë‹¤ input sourceë¥¼ ì˜ë¬¸ìœ¼ë¡œ ì „í™˜í•˜ê²Œ í•œë‹¤. Vim ì‚¬ìš©ìì—ê²Œ ë„ˆë¬´ ì¢‹ì€ ê¸°ëŠ¥.
* í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìœˆë„ìš°ë¥¼ íŠ¹ì • ìœ„ì¹˜ë¡œ ì›€ì§ì´ê²Œ í•˜ê±°ë‚˜ ì‚¬ì´ì¦ˆë¥¼ ì¡°ì ˆí•œë‹¤.
* íŠ¹ì • ë‹¨ì¶•í‚¤ë¥¼ ì…ë ¥í•˜ë©´ ë‚´ê°€ ìì£¼ ì‚¬ìš©í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ê±°ë‚˜ í™œì„±í™”í•´ì¤€ë‹¤.
* ê°„ë‹¨í•œ GUI ë©”ë‰´ë¥¼ ë§Œë“¤ê³  ë‚´ê²Œ í•„ìš”í•œ ê¸°ëŠ¥ë“¤ì„ ë“±ë¡í•´ ì“´ë‹¤.
* íŠ¹ì • ì• í”Œë¦¬ì¼€ì´ì…˜(íŒŒì¸ë”ë¼ë˜ê°€)ì´ ì‹¤í–‰ë  ë•Œë§ˆë‹¤ ë¬´ì–¸ê°€ ë‹¤ë¥¸ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê²Œ í•œë‹¤.
* ë§¥ë¶ì´ íšŒì‚¬ ì™€ì´íŒŒì´ì— ì—°ê²°ë˜ë©´(ì¶œê·¼í•˜ë©´) ë§¥ë¶ì˜ ì‚¬ìš´ë“œ ë³¼ë¥¨ì„ 0ìœ¼ë¡œ ì¡°ì •í•œë‹¤.
* ì• í”ŒìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•œë‹¤.
* iMessageë¥¼ ì „ì†¡í•œë‹¤.
* í„°ë¯¸ë„ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•œë‹¤.
* ê·¸ ì™¸ ìì„¸í•œ ë‚´ìš©ì€ [Getting Started with Hammerspoon](http://www.hammerspoon.org/go/)ì„ ì°¸ê³ .

# ë°œë‹¨: ì„¤ì • íŒŒì¼ì´ ì ì  ë¹„ëŒ€í•´ì ¸ ê°„ë‹¤

ë‚˜ëŠ” Hammerspoon ì„¤ì • íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ê´€ë¦¬í–ˆë‹¤.

```
/.hammerspoon
    â”‚
    â”œ init.lua
    â”‚
    â”” /modules
        â”œ appman.lua
        â”œ clipboard.lua
        â”œ caffein.lua
        â”œ inputSourceChange.lua
        â”œ mouse.lua
        â”” vim.lua
```

íŒŒì¼ëª…                | ì„¤ëª…
:--                   | ----
init.lua              | Hammerspoon ì„¤ì • main íŒŒì¼.
appman.lua            | ìì£¼ ì“°ëŠ” ì•± ì‹¤í–‰. ì˜ˆ) `F15+s`ë¥¼ ëˆ„ë¥´ë©´ Slack ì‹¤í–‰
clipboard.lua         | í´ë¦½ë³´ë“œ ê´€ë¦¬
caffein.lua           | ë§¥ë¶ì„ ê°€ë§Œíˆ ë†”ë‘¬ë„ ìŠ¬ë¦½ëª¨ë“œë¡œ ë“¤ì–´ê°€ì§€ ì•Šë„ë¡ í•œë‹¤
inputSourceChange.lua | í•œì˜ì „í™˜ ê´€ë ¨ ê¸°ëŠ¥
mouse.lua             | í‚¤ë³´ë“œë¡œ ë§ˆìš°ìŠ¤ë¥¼ ì œì–´
vim.lua               | ì–´ë””ì—ì„œê±´ vim ë¹„ìŠ·í•œ í‚¤ë§µì„ ì‚¬ìš©

## ê³ ë¯¼
* ì²˜ìŒì—” init.lua íŒŒì¼ í•˜ë‚˜ì˜€ì§€ë§Œ 1ë…„ ë§Œì— 7ê°œë¡œ íŒŒì¼ì´ ë¶ˆì–´ë‚¬ë‹¤. ì•ìœ¼ë¡œ ë” ëŠ˜ì–´ë‚˜ê² ì§€.
* ë¶„ë¦¬ ê°€ëŠ¥í•œ ì—¬ëŸ¬ ëª¨ë“ˆì´ í•˜ë‚˜ì˜ ë ˆíŒŒì§€í† ë¦¬ì— ë“¤ì–´ê°€ ìˆì–´ ì»¤ë°‹ ë¡œê·¸ ê´€ë¦¬ê°€ ì§œì¦ ë‚œë‹¤.
* ëª¨ë“ˆë§ˆë‹¤ Github repoë¥¼ ê°ê° ë”°ê³ , init.luaì— repo ì£¼ì†Œë§Œ ë„£ìœ¼ë©´ í¸ë¦¬í•˜ì§€ ì•Šì„ê¹Œ?

## ëŒ€ì•ˆ: íŒ¨í‚¤ì§€ ê´€ë¦¬ìë¥¼ ë§Œë“¤ì?
* vim í”ŒëŸ¬ê·¸ì¸ ê´€ë¦¬ìë“¤ì²˜ëŸ¼ github ì£¼ì†Œë¥¼ ë„£ì–´ë‘ë©´ ì•Œì•„ì„œ ë‹¤ìš´ë¡œë“œ í•˜ê³  ë§í¬ë„ ì‹œì¼œì£¼ëŠ” ê±¸ ë§Œë“¤ì–´ ë³¼ê¹Œ?
* ë§Œë“¤ í•„ìš” ìˆë‚˜? ë‚´ê°€ lua ë‰´ë¹„ë¼ ëª¨ë¥´ëŠ” ê±°ì§€, íŒ¨í‚¤ì§€ ê´€ë¦¬ì ê°™ì€ ê±´ ë‹¹ì—°íˆ ì„¸ê³„ì¸ë“¤ì´ ì‚¬ìš©í•˜ëŠ” ê²Œ ìˆì„ ê±°ë‹¤.
* ì°¾ì•„ë³´ë‹ˆ [luarocks](https://luarocks.org/)ë¼ëŠ” ê²ƒì´ ìˆë‹¤. ì´ê±¸ ì“°ì.

# luarocksë¥¼ ì‚¬ìš©í•´ ë³´ì

ëª©í‘œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
* ë‚´ê°€ ë§Œë“  ëª¨ë“ˆì„ init.luaì™€ í™•ì‹¤í•˜ê²Œ ë¶„ë¦¬í•œë‹¤.
* ë¶„ë¦¬í•œ ëª¨ë“ˆì„ luarocks ì €ì¥ì†Œì— ì—…ë°ì´íŠ¸í•œë‹¤.
* í•´ë‹¹ ëª¨ë“ˆì— ëŒ€í•´, ë‚´ ì„¤ì • íŒŒì¼ì—ëŠ” `require` ë¬¸ í•œ ì¤„ë§Œ ë‚¨ê¸´ë‹¤.
* Hammerspoonì„ ì¬ì‹¤í–‰í•˜ì—¬, í•´ë‹¹ ëª¨ë“ˆì˜ ê¸°ëŠ¥ì´ ì œëŒ€ë¡œ ì‹¤í–‰ë˜ë©´ ì„±ê³µ.

## ì‹¤í–‰: ë‚´ê°€ ë§Œë“  ëª¨ë“ˆì„ ë¶„ë¦¬í•˜ì

ì¼ë‹¨ í…ŒìŠ¤íŠ¸ë¡œ ë¶„ë¦¬í•  ëª¨ë“ˆì€ ê°„ë‹¨í•œ ê²Œ ì¢‹ì„ ê²ƒ ê°™ì•„ì„œ caffein.luaë¥¼ ì„ íƒí–ˆë‹¤.

ìµœì¢…ì ìœ¼ë¡œ init.luaì™€ ë¶„ë¦¬ê°€ ì™„ë£Œëœ caffein.luaì˜ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```lua
local caffeine = hs.menubar.new()

local obj = {}

local on_message = 'caffeinated'
local off_message = 'wait sleep'

local on_icon = "â˜•ï¸ğŸ™„"
local off_icon = "ğŸ˜´"

function obj:init(mod, key)

    function setCaffeineDisplay(state)
        if state then
            hs.alert.show(on_message)
            caffeine:setTitle(on_icon)
        else
            hs.alert.show(off_message)
            caffeine:setTitle(off_icon)
        end
    end

    function caffeineClicked()
        setCaffeineDisplay(hs.caffeinate.toggle("displayIdle"))
    end

    if caffeine then
        caffeine:setClickCallback(caffeineClicked)
        setCaffeineDisplay(hs.caffeinate.get("displayIdle"))
    end

    hs.hotkey.bind(mod, key, caffeineClicked)
end

return obj
```

ê·¸ë¦¬ê³  [Github repo](https://github.com/johngrib/hammerspoon_caffein/tree/0.1.0)ì— ì—…ë¡œë“œí–ˆë‹¤.

## ì‹¤í–‰: ë¶„ë¦¬í•œ ëª¨ë“ˆì„ luarocks ì €ì¥ì†Œì— ì—…ë¡œë“œí•˜ì

ì—…ë¡œë“œ ì¡°ê±´ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

* ë¨¼ì € [luarocks.org](https://luarocks.org/)ì— íšŒì› ê°€ì…ì„ í•´ì•¼ í•œë‹¤.
* ê°€ì…ì„ ë§ˆì¹˜ë©´ [https://luarocks.org/settings/api-keys](https://luarocks.org/settings/api-keys)ì—ì„œ api-keyë¥¼ ë³µì‚¬í•´ ë‘”ë‹¤. ì´ê²Œ ìˆì–´ì•¼ ë‚´ê°€ ë§Œë“  ëª¨ë“ˆì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆë‹¤.
* [Creating-a-rock](https://github.com/luarocks/luarocks/wiki/Creating-a-rock)ì„ ì½ê³  rockspec íŒŒì¼ì„ ì‘ì„±í•œë‹¤.

ë‚´ê°€ ì‘ì„±í•œ rockspec íŒŒì¼ì˜ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

```lua
-- ëª¨ë“ˆ íŒŒì¼ëª…ì€ hammerspoon_caffein.lua
-- rockspec íŒŒì¼ëª…ì€ johngrib.hammerspoon.caffein-0.1-1.rockspec
package = "johngrib.hammerspoon.caffein"
version = "0.1-1"

local url = "github.com/johngrib/hammerspoon_caffein"
local desc = "hammerspoon caffein"

source = {url = "git://" .. url}
description = {
  summary = desc,
  detailed = desc,
  homepage = "https://" .. url,
  license = "MIT",
}

-- Dependencies:
supported_platforms = {"macosx"}
dependencies = {
  "lua >= 5.2",
}

-- Build rules:
build = {
  type = "builtin",
  modules = {
    ["johngrib.hammerspoon.caffein"] = "hammerspoon_caffein.lua",
  },
}
```

ë§Œì•½ ìƒˆë¡œìš´ ëª¨ë“ˆì„ ì‘ì„±í•œë‹¤ë©´, ìœ„ì˜ íŒŒì¼ì—ì„œ `package`, `version`, `url`, `license`, `build.modules` ë§Œ ìˆ˜ì •í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ë‹¤ ë³µë¶™í•˜ë©´ ëœë‹¤.

ì•„ë¬´íŠ¼, rockspec íŒŒì¼ì„ ë‹¤ ì‘ì„±í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì—…ë¡œë“œ í•´ì£¼ë©´ ëœë‹¤.

```sh
$ luarocks upload johngrib.hammerspoon.caffein-0.1.rockspec --api-key=ë³µì‚¬í•´ë‘”apií‚¤
```

### ì—…ë¡œë“œ ì¤‘ JSON ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¬¸ì œ í•´ê²°

ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ëŠ” ë„ì¤‘ ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.
```sh
$ luarocks-5.3 upload johngrib.hammerspoon.caffein-0.1-1.rockspec --api-key=ë³µì‚¬í•´ë‘”apií‚¤
Sending johngrib.hammerspoon.caffein-0.1-1.rockspec ...

Error: A JSON library is required for this command.
```

ë‹¤í–‰íˆ ê²€ìƒ‰í•´ë³´ê³  í•œ ë²ˆì— í•´ê²°. ë‹¤ìŒê³¼ ê°™ì´ `dkjson` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ì£¼ë©´ ëœë‹¤.

```sh
$ luarocks install dkjson --local
```

ë‹¤ì‹œ ì—…ë¡œë“œí•˜ë‹ˆ ì„±ê³µí•œë‹¤.
```sh
$ luarocks-5.3 upload johngrib.hammerspoon.caffein-0.1-1.rockspec --api-key=ë³µì‚¬í•´ë‘”apií‚¤
Sending johngrib.hammerspoon.caffein-0.1-1.rockspec ...
Will create new module (johngrib.hammerspoon.caffein)
Packing johngrib.hammerspoon.caffein
Cloning into 'hammerspoon_caffein'...
remote: Counting objects: 5, done.
remote: Compressing objects: 100% (5/5), done.
remote: Total 5 (delta 0), reused 3 (delta 0), pack-reused 0
Receiving objects: 100% (5/5), done.
  adding: johngrib.hammerspoon.caffein-0.1-1.rockspec (deflated 52%)
  adding: hammerspoon_caffein/ (stored 0%)
  adding: hammerspoon_caffein/hammerspoon_caffein.lua (deflated 58%)
  adding: hammerspoon_caffein/LICENSE (deflated 39%)
Sending /Users/johngrib/git/hammerspoon_caffein/johngrib.hammerspoon.caffein-0.1-1.src.rock ...

Done: http://luarocks.org/modules/johngrib/johngrib.hammerspoon.caffein
```

## ì„¤ì • íŒŒì¼ì— `require` ë¬¸ í•œ ì¤„ë§Œ ë‚¨ê¸°ì

ì´ì œ ì—…ë¡œë“œëœ ëª¨ë“ˆì„ ë‹¤ì‹œ ë‹¤ìš´ë¡œë“œ í•œ ë‹¤ìŒ, ì„¤ì • íŒŒì¼ì—ì„œ ëª¨ë“ˆì„ `require` í•´ì£¼ê¸°ë§Œ í•˜ë©´ ëœë‹¤.

```sh
$ luarocks install johngrib.hammerspoon.caffein --local
```

ì„¤ì • íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•˜ì˜€ë‹¤.

```lua
-- ./modules/caffein.luaë¥¼ ì°¸ì¡°. ì´ì   ì£¼ì„ì²˜ë¦¬
-- require('modules.caffein'):init({'shift'}, 'f15')

-- luarocks ê´€ë¦¬ìì˜ johngrib.hammerspoon.caffeinì„ ì°¸ì¡°
require('luarocks.loader')
require('johngrib.hammerspoon.caffein'):init({'shift'}, 'f15')
```

* Hammerspoonì„ ì¬ì‹œë™í•˜ë‹ˆ ì´ìƒ ì—†ì´ ì˜ ëœë‹¤.
* ê¸°ì¡´ íŒŒì¼ì´ì—ˆë˜ ./modules/caffein.luaë¥¼ ì‚­ì œí•´ë„ ì˜ ëœë‹¤.
* ë‹¤ë¥¸ ëª¨ë“ˆë“¤ë„ ì´ë ‡ê²Œ ë¶„ë¦¬í•´ì•¼ê² ë‹¤.

# Links

* [Hammerspoon](http://www.hammerspoon.org/)
* [Autohotkey](https://autohotkey.com/)
* [Getting Started with Hammerspoon](http://www.hammerspoon.org/go/)
* [luarocks](https://luarocks.org/)
* [Creating-a-rock](https://github.com/luarocks/luarocks/wiki/Creating-a-rock)
* [github: johngrib/hammerspoon_caffein](https://github.com/johngrib/hammerspoon_caffein)
* [luarocks: johngrib.hammerspoon.caffein](https://luarocks.org/modules/johngrib/johngrib.hammerspoon.caffein)

EOB
